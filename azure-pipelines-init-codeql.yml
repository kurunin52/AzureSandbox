# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none
pr: none

pool:
  vmImage: 'windows-latest'

steps:
- task: CmdLine@2
  inputs:
    script: 'curl https://github.com/github/codeql-cli-binaries/releases/download/v2.9.3/codeql-win64.zip -O -J -L'
- task: ExtractFiles@1
  inputs:
    archiveFilePatterns: 'codeql-win64.zip'
    destinationFolder: '$(Pipeline.Workspace)'
    cleanDestinationFolder: false
    overwriteExistingFiles: false
- task: CmdLine@2
  inputs:
    script: |
      git clone https://github.com/github/codeql.git queries
    workingDirectory: '$(Pipeline.Workspace)\codeql'
- task: CmdLine@2
  inputs:
    script: |
      codeql query compile --compilation-cache='$(Pipeline.Workspace)\codeql\.cache' queries\csharp\ql\src\codeql-suites\csharp-security-and-quality.qls
    workingDirectory: '$(Pipeline.Workspace)\codeql'
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Pipeline.Workspace)\codeql'
    includeRootFolder: true
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/codeql.zip'
    replaceExistingArchive: true
- task: PublishPipelineArtifact@1
  inputs:
    targetPath: '$(Build.ArtifactStagingDirectory)/codeql.zip'
    artifact: 'codeql'
    publishLocation: 'pipeline'